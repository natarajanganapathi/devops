"use strict";(self.webpackChunkfacebook=self.webpackChunkfacebook||[]).push([[2478],{3905:function(n,e,t){t.d(e,{Zo:function(){return c},kt:function(){return g}});var i=t(7294);function a(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function o(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,i)}return t}function l(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach((function(e){a(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function r(n,e){if(null==n)return{};var t,i,a=function(n,e){if(null==n)return{};var t,i,a={},o=Object.keys(n);for(i=0;i<o.length;i++)t=o[i],e.indexOf(t)>=0||(a[t]=n[t]);return a}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)t=o[i],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(a[t]=n[t])}return a}var s=i.createContext({}),p=function(n){var e=i.useContext(s),t=e;return n&&(t="function"==typeof n?n(e):l(l({},e),n)),t},c=function(n){var e=p(n.components);return i.createElement(s.Provider,{value:e},n.children)},m={inlineCode:"code",wrapper:function(n){var e=n.children;return i.createElement(i.Fragment,{},e)}},d=i.forwardRef((function(n,e){var t=n.components,a=n.mdxType,o=n.originalType,s=n.parentName,c=r(n,["components","mdxType","originalType","parentName"]),d=p(t),g=a,u=d["".concat(s,".").concat(g)]||d[g]||m[g]||o;return t?i.createElement(u,l(l({ref:e},c),{},{components:t})):i.createElement(u,l({ref:e},c))}));function g(n,e){var t=arguments,a=e&&e.mdxType;if("string"==typeof n||a){var o=t.length,l=new Array(o);l[0]=d;var r={};for(var s in e)hasOwnProperty.call(e,s)&&(r[s]=e[s]);r.originalType=n,r.mdxType="string"==typeof n?n:a,l[1]=r;for(var p=2;p<o;p++)l[p]=t[p];return i.createElement.apply(null,l)}return i.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5348:function(n,e,t){t.r(e),t.d(e,{frontMatter:function(){return r},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var i=t(7462),a=t(3366),o=(t(7294),t(3905)),l=["components"],r={slug:"ansible",title:"Ansible",tags:["ansible"],sidebar_position:1},s="Ansible",p={unversionedId:"tools/ansible",id:"tools/ansible",title:"Ansible",description:"Setup Ansible Controle plane",source:"@site/docs/tools/ansible.md",sourceDirName:"tools",slug:"/tools/ansible",permalink:"/devops/docs/tools/ansible",editUrl:"https://github.com/natarajanmca11/devops/blob/main/docs/tools/ansible.md",tags:[{label:"ansible",permalink:"/devops/docs/tags/ansible"}],version:"current",sidebarPosition:1,frontMatter:{slug:"ansible",title:"Ansible",tags:["ansible"],sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Google Cloud Provider (GCP)",permalink:"/devops/docs/cloud/gcp"},next:{title:"NGINX",permalink:"/devops/docs/tools/nginx"}},c=[{value:"Setup Ansible Controle plane",id:"setup-ansible-controle-plane",children:[{value:"Install Ansible in Ubutu",id:"install-ansible-in-ubutu",children:[],level:3},{value:"Install Ansible in Windows",id:"install-ansible-in-windows",children:[],level:3}],level:2},{value:"Establish Connecton",id:"establish-connecton",children:[{value:"Windows (winrm)",id:"windows-winrm",children:[],level:3},{value:"Ubuntu (SSH)",id:"ubuntu-ssh",children:[],level:3}],level:2},{value:"Angular Application Deployed in NGINX Web Server",id:"angular-application-deployed-in-nginx-web-server",children:[{value:"Tasks",id:"tasks",children:[],level:3},{value:"Todo Tasks:",id:"todo-tasks",children:[],level:3},{value:"Sample playbook file",id:"sample-playbook-file",children:[],level:3}],level:2},{value:"Spring Bboot Application Deploy as Windows Service In Winsows",id:"spring-bboot-application-deploy-as-windows-service-in-winsows",children:[{value:"Tasks",id:"tasks-1",children:[],level:3},{value:"Todo Tasks:",id:"todo-tasks-1",children:[],level:3},{value:"Sample playbook file",id:"sample-playbook-file-1",children:[],level:3}],level:2}],m={toc:c};function d(n){var e=n.components,t=(0,a.Z)(n,l);return(0,o.kt)("wrapper",(0,i.Z)({},m,t,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"ansible"},"Ansible"),(0,o.kt)("h2",{id:"setup-ansible-controle-plane"},"Setup Ansible Controle plane"),(0,o.kt)("h3",{id:"install-ansible-in-ubutu"},"Install Ansible in Ubutu"),(0,o.kt)("h3",{id:"install-ansible-in-windows"},"Install Ansible in Windows"),(0,o.kt)("p",null,"TODO:"),(0,o.kt)("h2",{id:"establish-connecton"},"Establish Connecton"),(0,o.kt)("h3",{id:"windows-winrm"},"Windows (winrm)"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Open the port 5985 for HTTP and 5986 for HTTPS in the target Windows OS firewall and Cloud provider's ",(0,o.kt)("inlineCode",{parentName:"p"},"Security Group / Networking"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Install the ",(0,o.kt)("inlineCode",{parentName:"p"},"OpenSSH Server")," in target OS")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Run the ",(0,o.kt)("inlineCode",{parentName:"p"},"OpenSSH Server")," service in the target OS"))),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"}," To Allow Unencrypted Password, run the following command (Not Recomended)"),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre"},"Set-Item -Path WSMan:\\localhost\\Service\\Auth\\Basic -Value $true\nwinrm set winrm/config/service '@{AllowUnencrypted=\"true\"}'\n")))),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"connect using ",(0,o.kt)("inlineCode",{parentName:"li"},"ssh username@hostname"),". Ex. ",(0,o.kt)("inlineCode",{parentName:"li"},"ssh admin@192.168.0.1")," (or) ",(0,o.kt)("inlineCode",{parentName:"li"},"ssh -i key.pem username@hostname"))),(0,o.kt)("h3",{id:"ubuntu-ssh"},"Ubuntu (SSH)"),(0,o.kt)("p",null,"TODO:"),(0,o.kt)("h2",{id:"angular-application-deployed-in-nginx-web-server"},"Angular Application Deployed in NGINX Web Server"),(0,o.kt)("p",null,"(Controle plane is Ubntu -> Target OS is Windows)"),(0,o.kt)("h3",{id:"tasks"},"Tasks"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"/devops/docs/tools/nginx#nginx-instalation"},"Install")," the NGINX Web Server"),(0,o.kt)("li",{parentName:"ol"},"Configure the NGINX Web Server by edit/copy the ",(0,o.kt)("a",{parentName:"li",href:"/devops/docs/tools/nginx#https-web-server-sample-config"},"nginx.conf")," file"),(0,o.kt)("li",{parentName:"ol"},"Run the NGINX as windows service"),(0,o.kt)("li",{parentName:"ol"},"Zip the Angular distribution folder"),(0,o.kt)("li",{parentName:"ol"},"Copy to the target machine"),(0,o.kt)("li",{parentName:"ol"},"Remove existing deployment"),(0,o.kt)("li",{parentName:"ol"},"Unzip the file")),(0,o.kt)("h3",{id:"todo-tasks"},"Todo Tasks:"),(0,o.kt)("ol",{start:8},(0,o.kt)("li",{parentName:"ol"},"Open the port in target machine security firewall")),(0,o.kt)("h3",{id:"sample-playbook-file"},"Sample playbook file"),(0,o.kt)("p",null,"Deploy the static web application (html/css) in NGINX Web Server "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml",metastring:"title=playbook.yml",title:"playbook.yml"},'- hosts: {{HOSTS}}\n  remote_user: root\n  gather_facts: False\n\n  pre_tasks:\n  - debug: msg="Ansible is working!"\n  - name: ping\n    win_ping:\n\n  tasks:\n  # Install NGINX WebServer\n\n  - name: Install NGINX\n    win_chocolatey:\n      name: nginx\n      version: \'1.12.1\'\n      state: present\n\n  - name: Install nssm\n    win_chocolatey:\n      name: nssm\n      state: present\n\n  - name: Copy NGINX conf file\n    win_template: \n      src: nginx.conf.tpl\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\conf\\nginx.conf\n\n  - name: Copy Cert file 1\n    win_template: \n      src: ../cert.pem\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\conf\\cert.pem\n\n  - name: Copy Cert file 2\n    win_template: \n      src: ../cert.key\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\conf\\cert.key\n\n  - name: Create Log Folder\n    win_file:\n      path: C:\\nginx\n      state: directory\n\n  - name: Install nginx as service\n    win_nssm:\n      name: nginx\n      application: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\nginx.exe\n      app_parameters_free_form: -c C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\conf\\nginx.conf -p C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\n      stdout_file: C:\\nginx\\nginx_out.txt\n      stderr_file: C:\\nginx\\nginx_error.txt\n      start_mode: auto\n\n  - name: Start Nginx\n    win_service:\n      name: nginx\n      start_mode: auto\n      state: started\n\n  # - name: FirewallD rules\n  #   firewalld:\n  #     permanent: true\n  #     service: "{{ item }}"\n  #     state: enabled\n  #   with_items:\n  #     - http\n  #     - https\n\n  # Deploy the Angular Application\n\n  - name: Archive the Angular Application\n    archive:\n      path: /opt/atlassian/pipelines/agent/build/dist/Mission-web\n      dest: ./app.zip\n      format: zip\n    delegate_to: localhost\n    become: false\n\n  - name: Copy zip File to target\n    win_copy: \n      src: ./app.zip\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\\n\n  - name: Unarchive\n    win_unzip:\n      src: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\app.zip\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\\n      delete_archive: yes  \n\n  - name: Remove existing ui deployment\n    win_file:\n      path: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\html\n      state: absent\n\n  - name: Create Folder\n    win_file:\n      path: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\html\n      state: directory\n\n  - name: Move Content \n    win_copy:\n      remote_src: yes\n      src: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\Mission-web\\\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\html\\\n\n  - name: Remove directory structure\n    win_file:\n      path: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\Mission-web\n      state: absent\n')),(0,o.kt)("h2",{id:"spring-bboot-application-deploy-as-windows-service-in-winsows"},"Spring Bboot Application Deploy as Windows Service In Winsows"),(0,o.kt)("h3",{id:"tasks-1"},"Tasks"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"/devops/docs/tools/nginx#nginx-instalation"},"Install")," the NGINX Web Server")),(0,o.kt)("h3",{id:"todo-tasks-1"},"Todo Tasks:"),(0,o.kt)("ol",{start:8},(0,o.kt)("li",{parentName:"ol"},"Open the port in target machine security firewall"),(0,o.kt)("li",{parentName:"ol"},"Java SKD instalation")),(0,o.kt)("h3",{id:"sample-playbook-file-1"},"Sample playbook file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml",metastring:"titiel=playbook.yml",titiel:"playbook.yml"},"- hosts: {{HOSTS}}\n  remote_user: root\n  gather_facts: False\n\n  pre_tasks:\n  - debug: msg=\"Ansible is working in control machine\"\n  - name: Client machine connectivity check by Ping\n    win_ping:\n\n  tasks:\n\n  # PROXY Server Deployment\n\n  - name: Install NGINX\n    win_chocolatey:\n      name: nginx\n      version: '1.12.1'\n      state: present\n  \n  - name: Install nssm\n    win_chocolatey:\n      name: nssm\n      state: present\n\n  - name: Copy NGINX conf file\n    win_template: \n      src: nginx.conf.tpl\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\conf\\nginx.conf\n\n  # Certificate (.pem & .key ) files copy to target machine\n  \n  - name: Copy Cert file 1\n    win_template: \n      src: ../cert.pem\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\conf\\cert.pem\n\n  - name: Copy Cert file 2\n    win_template: \n      src: ../cert.key\n      dest: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\conf\\cert.key\n\n  - name: Create Log Folder\n    win_file:\n      path: C:\\nginx\n      state: directory\n\n  - name: Install nginx as service\n    win_nssm:\n      name: nginx\n      application: C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\nginx.exe\n      app_parameters_free_form: -c C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\\conf\\nginx.conf -p C:\\ProgramData\\chocolatey\\lib\\nginx\\tools\\nginx-1.12.1\n      stdout_file: C:\\nginx\\nginx_out.txt\n      stderr_file: C:\\nginx\\nginx_error.txt\n      start_mode: auto\n\n  - name: Start Nginx\n    win_service:\n      name: nginx\n      start_mode: auto\n      state: started\n\n  # - name: FirewallD rules\n  #   firewalld:\n  #     permanent: true\n  #     service: \"{{ item }}\"\n  #     state: enabled\n  #   with_items:\n  #     - http\n  #     - https\n\n  # REST API Deployment\n\n  - name: Remove Spring Boot service\n    win_service:\n      name: mission-api\n      state: absent\n    ignore_errors: yes\n\n  - name: Create Application Folder\n    win_file:\n      path: C:\\Mission\\App\n      state: directory\n\n  - name: Copy API application\n    copy: \n      src: /opt/atlassian/pipelines/agent/build/target/mission-app-core-1.0-SNAPSHOT.jar\n      dest: C:\\Mission\\App\\mission-app-core-1.0-SNAPSHOT.jar\n      directory_mode: yes\n\n  - name: Archive the Config\n    archive:\n      path: /opt/atlassian/pipelines/agent/build/src/main/resources/config\n      dest: ./config.zip\n      format: zip\n    delegate_to: localhost\n    become: false\n\n  - name: Copy zip File to target\n    win_copy: \n      src: ./config.zip\n      dest: C:\\Mission\\\n\n  - name: Remove existing Config\n    win_file:\n      path: C:\\Mission\\config\n      state: absent\n\n  - name: Unarchive\n    win_unzip:\n      src: C:\\Mission\\config.zip\n      dest: C:\\Mission\\\n      delete_archive: yes  \n\n  # - name: Install Java\n  #   win_chocolatey:\n  #     name: jdk8\n  #     state: present\n  #     version: 8.0.191\n\n  - name: Set Java_home\n    win_environment:\n      state: present\n      name: JAVA_HOME\n      value: 'C:\\Program Files\\java\\jdk1.8.0_191'\n      level: machine\n\n  - name: Add Java to path\n    win_path:\n      elements:\n        - 'C:\\Program Files\\java\\jdk1.8.0_191\\bin'\n\n  - name: Install Spring Boot app as Windows service (via nssm)\n    win_nssm:\n      name: mission-api\n      application: C:\\Program Files\\java\\jdk1.8.0_191\\bin\\java.exe\n      app_parameters_free_form: \"-jar C:/Mission/App/mission-app-core-1.0-SNAPSHOT.jar\"\n      state: stopped\n  \n  - name: Set the Application path for the Spring Boot app to the folder where the needed native libraries reside\n    raw: nssm set mission-api AppDirectory C:/Mission/\n\n  - name: Set SPRING_DATASOURCE_URL\n    win_environment:\n      state: present\n      name: SPRING_DATASOURCE_URL\n      value: 'jdbc:postgresql://{{dburl}}:{{dbport}}/{{dbname}}'\n      level: machine\n\n  - name: Set SPRING_DATASOURCE_USERNAME\n    win_environment:\n      state: present\n      name: SPRING_DATASOURCE_USERNAME\n      value: '{{dbusername}}'\n      level: machine\n\n  - name: Set SPRING_DATASOURCE_PASSWORD\n    win_environment:\n      state: present\n      name: SPRING_DATASOURCE_PASSWORD\n      value: '{{dbpassword}}'\n      level: machine\n\n  - name: Set SERVER_PORT\n    win_environment:\n      state: present\n      name: SERVER_PORT\n      value: '{{serverport}}'\n      level: machine\n\n  - name: Fire up Spring Boot app Windows service\n    win_service:\n      name: mission-api\n      state: restarted\n\n    ###### Smoke test, if app has booted up correctly\n  # - name: Wait until our Spring Boot app is up & running\n  #   win_uri:\n  #     url: \"https://{{SUBDOMAIN}}.mission.io/miosvc/actuator/health\"\n  #     method: GET\n  #   register: result\n  #   until: result.status_code is defined and result.status_code == 200 \n  #   retries: 5\n  #   delay: 5\n")))}d.isMDXComponent=!0}}]);